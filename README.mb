

# SwiftSocket.ioNative

**SwiftSocket.ioNative** es un cliente WebSocket 100% nativo en Swift 6, diseÃ±ado para replicar el comportamiento de `socket.io-client`, pero con una API moderna, segura para concurrencia y sin dependencias externas.

Es ideal para conectar tus apps iOS, macOS o tvOS con servidores basados en `socket.io` como Node.js o NestJS.

---

## ğŸš€ CaracterÃ­sticas

- ğŸ”Œ ConexiÃ³n WebSocket nativa (`URLSessionWebSocketTask`)
- ğŸ” AutenticaciÃ³n mediante `userId` (vÃ­a query param)
- ğŸ“¤ EnvÃ­o de eventos (`emit`)
- ğŸ“¥ Escucha de eventos (`on`)
- âœ… Soporte para ACKs opcionales (`emit(..., ack:)`)
- ğŸ” ReconexiÃ³n automÃ¡tica opcional
- ğŸ§  DecodificaciÃ³n tipada con `.decode(as:)`
- ğŸŸ¢ Ping/Pong automÃ¡tico configurable
- ğŸ”§ Flexible: sin singletons, sin restricciones de UI

---

## ğŸ“¦ InstalaciÃ³n

Agrega a tu `Package.swift`:

```swift
.package(url: "https://github.com/tuusuario/SwiftSocket.ioNative.git", from: "1.0.0")
```

Y en tus targets:

```swift
.target(
  name: "TuModulo",
  dependencies: [
    .product(name: "SwiftSocketIONative", package: "SwiftSocket.ioNative")
  ]
)
```

---

## ğŸ“ Uso bÃ¡sico

```swift
let socket = SwiftSocketIOClient(
    url: URL(string: "wss://tu-servidor.com/QA/chat/socket")!,
    userId: "usuario123",
    usePing: true,              // Opcional
    pingInterval: 10            // Opcional
)

socket.connect()

socket.emit(event: "sendMessage", data: ["text": "Hola"])

socket.on(event: "receiveMessage") { payload in
    print("ğŸ“¥ Datos recibidos:", payload ?? .null)
}
```

---

## ğŸ§  DecodificaciÃ³n tipada

```swift
struct ChatMessage: Codable {
    let text: String
    let sender: String
}

socket.on(event: "receiveMessage") { payload in
    if let message = payload?.decode(as: ChatMessage.self) {
        print("ğŸ“© \(message.sender): \(message.text)")
    }
}
```

---

## âœ… Confirmaciones (ACK)

```swift
socket.emit(event: "sendMessage", data: ["text": "Hola"]) { respuesta in
    print("ğŸ” ConfirmaciÃ³n:", respuesta ?? "sin respuesta")
}
```

---

## ğŸ” Ping/Pong automÃ¡tico

Activa ping/pong para mantener la conexiÃ³n viva:

```swift
let socket = SwiftSocketIOClient(
    url: myURL,
    userId: "usuario123",
    usePing: true,              // ğŸ” Activar ping
    pingInterval: 15            // Tiempo entre pings
)
```

El cliente enviarÃ¡ automÃ¡ticamente `"ping"` cada `pingInterval` segundos. Puedes escuchar `"pong"` desde el servidor si deseas registrar confirmaciÃ³n.

---

## ğŸ§ª Testing con Swift Testing

Este package es compatible con Swift Testing en Xcode 16+.

### Requisitos

- Swift 6 / Xcode 16 beta
- Variable de entorno `SOCKET_SERVER_URL`

```bash
SOCKET_SERVER_URL=wss://tu-servidor.ngrok.app swift test
```

### Ejemplo:

```swift
@Suite
struct SocketTests {
    struct TestMessage: Codable, Equatable {
        let text: String
    }

    @Test("Emitir con ACK")
    func testEmitAck() async throws {
        let url = URL(string: ProcessInfo.processInfo.environment["SOCKET_SERVER_URL"] ?? "")!
        let socket = SwiftSocketIOClient(url: url, userId: "test")

        try await withCheckedThrowingContinuation { cont in
            socket.connect()
            Task {
                try await Task.sleep(nanoseconds: 1_000_000_000)
                socket.emit(event: "sendMessage", data: TestMessage(text: "ping")) { _ in
                    cont.resume()
                }
            }
        }

        #expect(true)
    }
}
```

---

## ğŸ“ Estructura del paquete

```
Sources/
â””â”€â”€ SwiftSocketIONative/
    â”œâ”€â”€ SwiftSocketIOClient.swift
    â”œâ”€â”€ SocketEvent.swift
    â”œâ”€â”€ CodableValue.swift
    â”œâ”€â”€ AckManager.swift
    â”œâ”€â”€ EventRouter.swift
    â””â”€â”€ Protocols.swift

Tests/
â””â”€â”€ SwiftSocketIONativeTests/
    â””â”€â”€ SwiftSocketIOClientTests.swift
```

---

## ğŸ§© Requisitos

- Swift 6
- iOS 15+, macOS 12+, tvOS 15+
- Xcode 15.3+ (Xcode 16 recomendado para Testing)

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo licencia MIT. Consulta [LICENSE](./LICENSE) para mÃ¡s detalles.

---

## ğŸ¤ Contribuciones

Â¡Pull requests y sugerencias bienvenidas!

Este package busca replicar el 100% del comportamiento de `socket.io-client`, pero usando solo tecnologÃ­as nativas de Swift y Apple.

---

## ğŸ’¬ Contacto

Â¿Tienes dudas o mejoras?
Abre un issue o crea un PR directamente en [github.com/tuusuario/SwiftSocket.ioNative](https://github.com/tuusuario/SwiftSocket.ioNative)

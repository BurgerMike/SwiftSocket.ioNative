
# SwiftSocket.ioNative

**SwiftSocket.ioNative** es un cliente 100% nativo en Swift que replica las funciones clave de `socket.io-client`, compatible con cualquier servidor `socket.io`, incluyendo rutas personalizadas, autenticaciÃ³n con `userId`, eventos `emit/on`, ACKs, y reconexiÃ³n automÃ¡tica.

Ideal para conectar apps iOS/macOS con backends Node.js, NestJS u otros que utilicen `socket.io`.

---

## ğŸš€ CaracterÃ­sticas

- ğŸ”Œ ConexiÃ³n WebSocket nativa (`URLSessionWebSocketTask`)
- ğŸ›£ Soporte para rutas como `/QA/chat/socket`
- ğŸ” AutenticaciÃ³n con `userId`
- ğŸ“¤ EnvÃ­o de eventos con `emit(event:data:)`
- ğŸ“¥ Escucha de eventos con `on(event:)`
- âœ… Soporte para ACKs (confirmaciones)
- ğŸ§  `on<T: Decodable>` para recibir objetos tipados
- ğŸ” ReconexiÃ³n automÃ¡tica
- ğŸ§ª Pruebas con Swift Testing (Swift 5.9+)

---

## ğŸ“¦ InstalaciÃ³n

Agrega a tu `Package.swift`:

```swift
.package(url: "https://github.com/tuusuario/SwiftSocket.ioNative.git", from: "1.0.0")
```

Y en tu target:

```swift
.target(
  name: "TuModulo",
  dependencies: ["SwiftSocket.ioNative"]
)
```

---

## ğŸ“ Uso BÃ¡sico

```swift
let socket = SwiftNativeSocketIOClient(
    baseURL: URL(string: "wss://tu-servidor.com")!,
    path: "/QA/chat/socket",
    userId: "usuario123"
)

socket.connect()

socket.emit(event: "sendMessage", data: ["text": "Hola"])

socket.on(event: "receiveMessage") { any in
    print("ğŸ“¥ Datos recibidos:", any)
}
```

---

## ğŸ§  RecepciÃ³n de objetos tipados

```swift
struct ChatMessage: Codable {
    let text: String
    let sender: String
}

socket.on(event: "receiveMessage", decodeTo: ChatMessage.self) { mensaje in
    print("ğŸ“© \(mensaje.sender): \(mensaje.text)")
}
```

---

## âœ… Confirmaciones (ACKs)

```swift
socket.emit(event: "sendMessage", data: ["text": "Hola"]) { respuesta in
    print("ğŸ” ConfirmaciÃ³n del servidor:", respuesta ?? "nula")
}
```

---

## ğŸ§ª Testing (Swift Testing)

### Requisitos

- Swift 5.9+
- Xcode 15.3 o superior (o Xcode 16 beta)
- Soporte para `#expect`, `@Suite`, `@Test`

### Variable de entorno

Este paquete usa una variable `SOCKET_SERVER_URL` para permitir tests en servidores reales o locales.

```bash
SOCKET_SERVER_URL=wss://tu-servidor.ngrok.app swift test
```

O en Xcode:

- **Edit Scheme > Test > Arguments > Environment Variables**
  - Name: `SOCKET_SERVER_URL`
  - Value: `wss://tu-servidor.ngrok.app`

---

### Ejemplo de test

```swift
@Suite
struct SwiftNativeSocketIOClientTests {
    struct MockMessage: Codable, Equatable {
        let text: String
        let sender: String
    }

    @Test("Emit con ACK")
    func testEmitAck() async throws {
        let url = ProcessInfo.processInfo.environment["SOCKET_SERVER_URL"] ?? "wss://localhost"
        let socket = SwiftNativeSocketIOClient(
            baseURL: URL(string: url)!,
            path: "/QA/chat/socket",
            userId: "tester"
        )

        try await withCheckedThrowingContinuation { cont in
            socket.connect()
            Task {
                try await Task.sleep(nanoseconds: 1_000_000_000)
                socket.emit(event: "sendMessage", data: MockMessage(text: "Hola", sender: "SwiftTest")) { _ in
                    cont.resume()
                }
            }
        }

        #expect(true)
    }
}
```

---

## ğŸ“ Estructura del paquete

```
Sources/
â””â”€â”€ SwiftSocket.ioNative/
    â”œâ”€â”€ SwiftNativeSocketIOClient.swift
    â”œâ”€â”€ SocketEvent.swift
    â”œâ”€â”€ AckManager.swift
    â”œâ”€â”€ ReconnectManager.swift
    â””â”€â”€ Protocols.swift

Tests/
â””â”€â”€ SwiftSocketIONativeTests/
    â””â”€â”€ SwiftNativeSocketIOClientTests.swift
```

---

## ğŸ§© Requisitos

- Swift 5.9+
- iOS 14+, macOS 13+, tvOS 14+
- Xcode 15.3 o superior (Xcode 16 recomendado para Swift Testing)

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo licencia MIT. Consulta [LICENSE](./LICENSE) para mÃ¡s detalles.

---

## ğŸ¤ Contribuciones

Â¡Pull requests y mejoras bienvenidas!
Este paquete busca evolucionar hasta cubrir el 100% del comportamiento de `socket.io-client`, pero con API nativa de Swift, cero dependencias externas y soporte multiplataforma Apple.

---

## ğŸ’¬ Contacto

Para sugerencias, dudas o mejoras, puedes abrir un issue en el repositorio o contribuir directamente.
